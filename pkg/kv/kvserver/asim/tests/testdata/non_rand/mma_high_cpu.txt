skip_under_ci
----

gen_cluster nodes=10 node_cpu_rate_capacity=8000000000
----

# Set the rebalance mode to use the mma store rebalancer and disable the lease
# and replicate queues so that only the mma store rebalancer is moving replicas
# or leases.
setting split_queue_enabled=false
----

# This workload will be initially evenly distributed over the cluster.
gen_ranges ranges=100 min_key=0 max_key=10000
----

gen_load rate=5000 rw_ratio=0.95 min_block=100 max_block=100 request_cpu_per_access=100 raft_cpu_per_write=20 min_key=0 max_key=10000
----

# Another workload is added over the second half of the keyspace, which is initially
# only on s1-s3.
gen_ranges ranges=50 min_key=10001 max_key=20000 placement_type=skewed
----

gen_load rate=5000 rw_ratio=0.95 min_block=128 max_block=128 request_cpu_per_access=100000 raft_cpu_per_write=20000 min_key=10001 max_key=20000
----

eval duration=15m samples=1 seed=42 cfgs=(mma-only,mma-count) metrics=(cpu,write_bytes_per_second,replicas,leases)
----
cpu#1: last:  [s1=274870057, s2=124118783, s3=42166496, s4=21298975, s5=10805903, s6=10577758, s7=453407, s8=10306222, s9=10413474, s10=10503921] (stddev=81956672.84, mean=51551499.60, sum=515514996)
cpu#1: thrash_pct: [s1=7%, s2=6%, s3=4%, s4=3%, s5=2%, s6=2%, s7=0%, s8=2%, s9=2%, s10=2%]  (sum=30%)
leases#1: first: [s1=37, s2=22, s3=14, s4=13, s5=11, s6=11, s7=10, s8=11, s9=10, s10=11] (stddev=8.07, mean=15.00, sum=150)
leases#1: last:  [s1=37, s2=22, s3=14, s4=13, s5=11, s6=11, s7=10, s8=11, s9=10, s10=11] (stddev=8.07, mean=15.00, sum=150)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=0%)
replicas#1: first: [s1=80, s2=70, s3=51, s4=42, s5=37, s6=35, s7=34, s8=33, s9=34, s10=34] (stddev=16.02, mean=45.00, sum=450)
replicas#1: last:  [s1=80, s2=70, s3=51, s4=42, s5=37, s6=35, s7=34, s8=33, s9=34, s10=34] (stddev=16.02, mean=45.00, sum=450)
replicas#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=0%)
write_bytes_per_second#1: last:  [s1=39511, s2=33080, s3=20899, s4=15208, s5=11942, s6=10699, s7=10093, s8=9465, s9=10055, s10=10043] (stddev=10247.09, mean=17099.50, sum=170995)
write_bytes_per_second#1: thrash_pct: [s1=13%, s2=18%, s3=20%, s4=19%, s5=17%, s6=16%, s7=14%, s8=14%, s9=17%, s10=16%]  (sum=165%)
artifacts[mma-only]: bd71a8872f557e0f
==========================
cpu#1: last:  [s1=153545974, s2=82571497, s3=61967377, s4=31436939, s5=21209665, s6=31257441, s7=10903219, s8=40903888, s9=51026201, s10=30714935] (stddev=39256550.41, mean=51553713.60, sum=515537136)
cpu#1: thrash_pct: [s1=10%, s2=6%, s3=7%, s4=5%, s5=4%, s6=6%, s7=3%, s8=6%, s9=7%, s10=5%]  (sum=58%)
leases#1: first: [s1=37, s2=22, s3=14, s4=13, s5=11, s6=11, s7=10, s8=11, s9=10, s10=11] (stddev=8.07, mean=15.00, sum=150)
leases#1: last:  [s1=20, s2=16, s3=15, s4=16, s5=12, s6=14, s7=12, s8=15, s9=15, s10=15] (stddev=2.14, mean=15.00, sum=150)
leases#1: thrash_pct: [s1=0%, s2=0%, s3=15%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=15%)
replicas#1: first: [s1=80, s2=70, s3=51, s4=42, s5=37, s6=35, s7=34, s8=33, s9=34, s10=34] (stddev=16.02, mean=45.00, sum=450)
replicas#1: last:  [s1=45, s2=44, s3=44, s4=47, s5=44, s6=44, s7=44, s8=45, s9=46, s10=47] (stddev=1.18, mean=45.00, sum=450)
replicas#1: thrash_pct: [s1=0%, s2=0%, s3=0%, s4=0%, s5=0%, s6=0%, s7=0%, s8=0%, s9=0%, s10=0%]  (sum=0%)
write_bytes_per_second#1: last:  [s1=25330, s2=20719, s3=18391, s4=17246, s5=15288, s6=15257, s7=14520, s8=14450, s9=15382, s10=14423] (stddev=3361.47, mean=17100.60, sum=171006)
write_bytes_per_second#1: thrash_pct: [s1=84%, s2=62%, s3=67%, s4=35%, s5=45%, s6=38%, s7=29%, s8=29%, s9=42%, s10=40%]  (sum=471%)
artifacts[mma-count]: abbd0fc9dbc1971a
==========================
