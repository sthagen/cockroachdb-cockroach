# LogicTest: local !metamorphic-batch-sizes
# We must turn off metamorphic variables because some are included in
# EXPLAIN (OPT, ENV) output.

statement ok
CREATE TABLE x (
  a INT PRIMARY KEY,
  b INT,
  INDEX (b),
  FAMILY "primary" (a, b)
)

statement ok
ALTER TABLE x INJECT STATISTICS '[
  {
    "columns": ["a"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 100,
    "histo_col_type": ""
  },
  {
    "columns": ["b"],
    "created_at": "2018-01-01 1:00:00.00000+00:00",
    "row_count": 123123,
    "distinct_count": 123123,
    "histo_col_type": ""
  }
]'

statement ok
CREATE TABLE y (
  u INT PRIMARY KEY,
  v INT REFERENCES x,
  INDEX (v),
  FAMILY "primary" (u, v)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM x WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4kZNdBA4KzHXVzVvqFLbatSgKgpKOZC4UyZKUamcY0IfIE_ZJBlJK4mCRlWBoLoKIOd_5_c5HDofwHrVhUoxhKtNLLWm6evUScI1pUjGeoQaLxkLdWAXBcAiUc_mVKI2KaiTUEKksUZwKWFEDdoWQYU4rbqGmvMIxyDx3uFQaS0xKhSFfmV2R1oqkkhPDrrAHnlGXyYZ32s2WFwfw5tVHb9z6ZsLu9H26bWw1FYamlklBlGZSM7vpAgqpS8q70F8qypndEJkTg7pmaWcCGouKU93lSCPNiBS8M4-b5jyArQySXLphofaOTJ8TpjH186hKQXU7KxQ04Zj1Yk3Di7zinFgHafC7cMsodkBrvnB44U7OAO6KubGklZUuRJMIYaXiLGWWGOQu3VxqUinHjs5Q4iH4dqucj4TadEWMpRZLFLY78XvehEFtSU6NJYra1aNAZcUtU-4PmbGcpdTlYBxZfN96Ot06uWLFFS3IX5L17R2ulesTFRlhhZAaiZCW1Mww56eZtiFMkFSqPp6xzBd9r3kGjdMGYlmJsrJdHsJb_JMAwqKuKd-5-UoaW2g0DsCpLrBhoeMf0fJr5yhHYeiDcJm2-6osK9kVZkRRbZkrDzPCRIZr7233eLlMLx9VlHDZSZ2hxoxwajqt2667ZfYMJxpXskRXVO9e-pScNBvFWSO8hLOSdQY7Dn8-bTG-CbpVEI0pNX37cB-0YsbKQtPySSi_F_42sPRp8bYJ7aeFfVqnCmJ1UR4aVjJOndITu9JoVpJ3tjQ8PPFQjTlqwqW8rJRfQOMFJL_sDaqlooWbIxOqsg0FmCh6YBq9YRtq5wz9AM0XTgzNsSVNX1a3kvco7rpLmImC3A3A3-sKta104qXsiXh3dbjB6YojUVomNGF8x9Xb4UZTkcmSGOzeiQbJSrySolNM3sVTb7alcI_pSyUSWYmskQ7KOfL--8_DUimM1ZQ5pRHSqXDtSbElO4-8g2tMrdS7XlIiCKaLaBJHEE9enke-i4eqSjhLD9ewFzyjMJvHpzC_iGH-7vz8IHiWtCfN1_RivowXk9k8hjVRl7iBt4vZm8niI_wRfYQ9CpPldP8geDabv4o-wJokhGVr2Ev8ebB_FgST8zhaPBh-Nv89msawjCfxbBnPpkt4_ikAAPjb_3Y_A1oX_j03GEN4cHfcXmKDMXy6PWzsB7ffn7ftNVKLGaF2MIbBcTg6HYajYTiCcDQOw3EYDraM3QuFCf8wqoQDjMLt2F7r_CPWbpRLbLAN9lJ_A9yGOQm_dXh8Mjo-8f_75-D_lpz8kJJ9hj-u6uDz87Md3Nw4blb_4Wbdxc3NA9ysbrh5z64mubN8fbGIZr_OG8t6HxbR62gRzafREm74uUfviO1wnth1P7E3DxLb1xt9eHs-mc1h7-JtfADR_P0-LKNzZ_sTvF5cvIE1_PlbtIgggRdwchYMh8Nh4N8h61_a3Qrg-_X19-tv36-_wa2S2DEcHR-NxvDp6ASGcHTyOfg3AAD__4UpojA=


statement error pq: at or near "EOF": syntax error: the ENV flag can only be used with OPT
EXPLAIN (ENV) SELECT * FROM x WHERE b = 3

#
# Multiple Tables.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x, y WHERE b = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0VtFu2zYXvq6e4sA3dX7YiZz8F4GDAnNddfOWOoWtdi2KgqCkI5kLRaokpdoZBhR7hlzu6fIkAynFcdDISjA0F4FNf9_h4Tnf-cjhEN6j0kyKMUxlfKkkjVevXgKuMY5KxhNUYFAbqGqU5w2HQDmXX0mhsKAKCdVEFoYUnApYUQ1mhZBgSktuoKK8xDHINLW8WGpDdEyFJl-ZWZEGRWLJiWZX2EFPqM1kw1txs-XFAN68-ujATWwmzN7Yp7tgo6jQNDZMClIoJhUzmzaikCqnvI39paScmQ2RKdGoKha3JqAwKzlVbYEU0oRIwVvzuC3OA9xSI0mlbRYqF0h3BWEKY9ePMhdUNb1CQSOOSSdX17pIS86JsZSav4-3DEJLNPoLhxd25Qzg7jC3SFoaabeoEyEsLziLmSEauU03lYqUhVVH61biIfpuqWyMiJp4RbShBnMUpj3xe9GERmVISrUhBTWrR5HykhtW2A8yYSmLqc1BW7G4unVUuglyxbIrmpE_JOuaO1wXtk5UJIRlQiokQhpSMc1snLrbmjBBYll06Ywl7tD3iqdRW28ghuUoS9MWwd_yn0QQBlVF-d7JL6Q2mUJtCZyqDGsVWv0RJb-2tnLk-24TLuNmXgvDcnaFCSmoMsweDxPCRIJrF21_e7mMLx91KGGzkypBhQnhVLeim6rbYXYKJwpXMkd7qM65dClZa9YFZ7XxEs5y1rrZsf__04bjiqAaB1EYU901D_dJK6aNzBTNn8Ryc-FuA0Oftt-uoF23sMvriowYleWHmuWMU-v0xKwU6pXkrSX1D08cVWGKinApL8vCDaB2BpJedm6qZEEz20cmitLUEmAi66ApdMBmq709dA3UXzjRNMVGNF1ZbS3vUdq1lzATGblrgLvXC1SmVJGzsify7dVhG6dKjqRQMqIR43uu3pYwiopE5kRj-0zUTJbjlRStZvIunDrYjsM9pi6liGQpkto6KOfIu-8_R4ul0EZRZp1GSOvClRPFju088g6uMDZS7XtJCc-bLoJJGEA4eXkeuCoeFmXEWXy4hr73jMJsHp7C_CKE-bvz84H3LGpW6m_Ti_kyXExm8xDWpLjEDbxdzN5MFh_ht-Aj9ClMltODgfdsNn8VfIA1iQhL1tCP3Lp3cOZ5k_MwWDy4_Wz-azANYRlOwtkynE2X8PyTBwDwp_tv_3q0ytx7rjcGf3C33FxivTF82i7W-N72--ddvEJqMCHU9MbQO_ZHp0N_NPRH4I_Gvj_2_d4O2L5QmHAPo1JYwsjf3dt5nXvEmk1hE-vtkp3V3xJ3adbCtwGPT0bHJ-63vwb_9cjRDzmyy_DHndr7_PxsjzY3Vpvld9qs2rS5eUCb5a027-Eqklrk64tFMPt5XiOrA1gEr4NFMJ8GS7jVZ5_eCdvynLCrbmFvHhS2O2_w4e35ZDaH_sXbcADB_P0BLINzi_0fvF5cvIH1ADbw-y_BIoAIXsDJmTccDoceEwLV0D39-rGSWh94cHP9z831t5vrb-AeKpvvVtY_NeNof_nbVv3m-roBbD3IjOHo-Gg0hk9HJzCEo5PP3g4sZdyg0tA3qsQD798AAAD__38oxjk=

#
# Same table twice should only show up once.
#

query T
EXPLAIN (OPT, ENV) SELECT * FROM x one, x two
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3dQY7kNNdBA564brq4C21C1stWhQFQUtHMheKZElKsTMM6EPkck-XJxlIKYmDRVaCobkILOl85_c7HzkcwifUhkkxhqlMLrSkyebtG8AtJuuS8RQ1WDQWqtoqCIZDoJzLS6I0KqqRUEOkskRxKmBDDdgNQooZLbmFivISxyCzzOESaSwxCRWGXDK7IY0VSSQnhl1hBzylLpMdb7WbrRYDeP_2izdufDNhD_o-3Te2mgpDE8ukIEozqZndtQGF1AXlbejvJeXM7ojMiEFdsaQ1AY15yaluc6SRpkQK3prHbXMewZYGSSbdsFB7R6bLCdOY-HmUhaC6mRUKuuaYdmJNzYus5JxYB6nxh3CrKHZAa75zeO3enAHcF3NrSUsrXYg6EcIKxVnCLDHIXbqZ1KRUjh2tocRj8P1WOR9rapMNMZZaLFDY9sQfeBMGtSUZNZYoajdPAhUlt0y5HzJlGUuoy8E4svi-dXS6cXLF8iuakz8l69o73CrXJypSwnIhNRIhLamYYc5PPW1DmCCJVF08Y6kv-kHzDBqnDcSyAmVp2zyEd_hnAYRFXVF-cPOVNDbXaByAU51jzULHP6LlZesoR2Hog3CZNPuqLCvYFaZEUW2ZKw9TwkSKW-_t8Hi5TC6eVJRw2UmdosaUcGparZuuu2X2DCcaN7JAV1TnXvqUnDQbxVktvISzgrUGOwl_PW0wvgm6URCNCTVd-_AQtGHGylzT4lkovxf-NLD0efH2Ce2nhV1ap3JidV4cG1YwTp3SE7vRaDaSt7Y0PH7loRoz1IRLeVEqv4DGC0h20RlUS0VzN0cmVGlrCjCRd8A0esMm1MEZ-gGa75wYmmFDmq6s7iTvSdx1hzATObkfgD_XFWpb6rWXsmfi3dHhBqdLjkRpuaZrxg8cvS1uNBWpLIjB9p2okazAKylaxeRjPPVmewr3lL6UYi1LkdbSQTlH3n3-eVgihbGaMqc0QjoVrjwp9mTniWdwhYmV-tBNSgTBdBlN4gjiyZvzyHfxWJVrzpLjLfSDFxRm8_gU5osY5h_PzwfBi3Xzpn6aLuareDmZzWPYEnWBO_iwnL2fLL_AH9EX6FOYrKZHg-DFbP42-gxbsiYs3UJ_7d8HR2dBMDmPo-Wj4Wfz36NpDKt4Es9W8Wy6gpdfAwCAv_x_99ejVe7vc70xhIP7180h1hvD17uXtX3v7vnbvr1GajEl1PbG0DsJR6fDcDQMRxCOxmE4DsPenrG7oTDhL0alcIBRuB_ba52_xNqdcon19sFe6m-B-zAn4XcOT16NTl75b38P_m_J659Sss_w51UdfHt5doCbO8fN8j_crNq4uXuEm-UtNx_YVSRzlu8Wy2j227y2rI5gGb2LltF8Gq3glp99ek9sh_PErrqJvXuU2L7e6POH88lsDv3Fh3gA0fzTEayic2f7C7xbLt7DFiYrkAIH9S97Kc-C4XA4DJgQqIf-8tdPtDTmKICb639urn_cXP8Af1XZwldqXkuB31o-2UvpP103nzLGLWoDfatLPAr-DQAA__8mn7qk

#
# Set a relevant session variable to a non-default value and ensure it shows up
# in the environment dump.
#

statement ok
SET reorder_joins_limit = 63

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_5_c5H9vvwAbVhUoxgIpNLLWmyev0KcI3JsmQ8RQ0WjYWqtgqCfh8o5_IbURoV1UioIVJZojgVsKIG7AohxYyW3EJFeYkjkFnmcIk0lpiECkO-MbsijRVJJCeGXWEHPKUukw1vtZsuLo7g7etP3rjxzYTd6_t029hqKgxNLJOCKM2kZnbTBhRSF5S3ob-WlDO7ITIjBnXFktYENOYlp7rNkUaaEil4ax63zdmBLQ2STLphofaOTJcTpjHx8ygLQXUzKxR0yTHtxJqaF1nJObEOUuP34RZR7IDWfOXw0p2cAdwXc2tJSytdiDoRwgrFWcIsMchdupnUpFSOHa2hxC74dqucjyW1yYoYSy0WKGx74g-8CYPakowaSxS1q0eBipJbptwfMmUZS6jLwTiy-L51dLpxcsXyK5qTvyTr2jtcK9cnKlLCciE1EiEtqZhhzk89bUOYIIlUXTxjqS_6QfMMGqcNxLICZWnbPIR3-CcBhEVdUb5385U0NtdoHIBTnWPNQsc_ouW31lEOwtAH4TJp9lVZVrArTImi2jJXHqaEiRTX3tv-8XKZXD6qKOGykzpFjSnh1LRaN113y-wZTjSuZIGuqM699Ck5aTaKs1p4CWcFaw12Ev582mB8E3SjIBoTarr24SFoxYyVuabFk1B-L_xtYOnT4m0T2k8Lu7RO5cTqvDg2rGCcOqUndqXRrCRvbWl4PPRQjRlqwqW8LJVfQOMFJLvsDKqlormbIxOqtDUFmMi7NFKjt2xi1UN8Cb8Md8qln6H5yomhGTa86UrsTvUeRV93DzORk_sZ-KtdobalXno1eyLe3R5udrrkSJSWS7pkfM_t2-JGU5HKghhsX4sayQq8kqJVT97HE2-2JXKP6UsplrIUaa0elHPk3VeghyVSGKspc2IjpBPiyvNiS3keeQ1XmFip9z2mRBBM5tE4jiAevzqPfBePVbnkLDlew0HwjMJ0Fp_C7CKG2fvz86Pg2bI5qb8mF7NFPB9PZzGsibrEDbybT9-O55_gj-gTHFAYLyaHR8Gz6ex19BHWZElYuoaDpT8PDs-CYHweR_Od4aez36NJDIt4HE8X8XSygOefAwCAv_1v99OjVe6fdL0RhEf3x8091hvB57vD2r539_1l214jtZgSansj6J2Eg9N-OOiHAwgHozAchWFvy9g9Upjwb6NSOMAg3I7t5c6_Y-1GucR622Cv9rfAbZhT8TuHJ8PBydD_75-j_1vy8oeU7DP8cVUHX56f7eHmxnGz_A83qzZubnZws7zl5gO7imTO8s3FPJr-Oqstq0OYR2-ieTSbRAu45ecBvSe2w3liV93E3uwktq83-vjufDydwcHFu_gIotmHQ1hE5872J3gzv3gLG_jzt2geQQkvYXgW9Pv9fuCfIpsAbq6vb66_31x_hzsFsSN4MRjB5xdD6MOL4Zfg3wAAAP__BuWeVw==

# Make sure it shows up correctly even if it matches the cluster setting.
statement ok
SET CLUSTER SETTING sql.defaults.reorder_joins_limit = 63


query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_5_c5H9vvwAbVhUoxgIpNLLWmyev0KcI3JsmQ8RQ0WjYWqtgqCfh8o5_IbURoV1UioIVJZojgVsKIG7AohxYyW3EJFeYkjkFnmcIk0lpiECkO-MbsijRVJJCeGXWEHPKUukw1vtZsuLo7g7etP3rjxzYTd6_t029hqKgxNLJOCKM2kZnbTBhRSF5S3ob-WlDO7ITIjBnXFktYENOYlp7rNkUaaEil4ax63zdmBLQ2STLphofaOTJcTpjHx8ygLQXUzKxR0yTHtxJqaF1nJObEOUuP34RZR7IDWfOXw0p2cAdwXc2tJSytdiDoRwgrFWcIsMchdupnUpFSOHa2hxC74dqucjyW1yYoYSy0WKGx74g-8CYPakowaSxS1q0eBipJbptwfMmUZS6jLwTiy-L51dLpxcsXyK5qTvyTr2jtcK9cnKlLCciE1EiEtqZhhzk89bUOYIIlUXTxjqS_6QfMMGqcNxLICZWnbPIR3-CcBhEVdUb5385U0NtdoHIBTnWPNQsc_ouW31lEOwtAH4TJp9lVZVrArTImi2jJXHqaEiRTX3tv-8XKZXD6qKOGykzpFjSnh1LRaN113y-wZTjSuZIGuqM699Ck5aTaKs1p4CWcFaw12Ev582mB8E3SjIBoTarr24SFoxYyVuabFk1B-L_xtYOnT4m0T2k8Lu7RO5cTqvDg2rGCcOqUndqXRrCRvbWl4PPRQjRlqwqW8LJVfQOMFJLvsDKqlormbIxOqtDUFmMi7NFKjt2xi1UN8Cb8Md8qln6H5yomhGTa86UrsTvUeRV93DzORk_sZ-KtdobalXno1eyLe3R5udrrkSJSWS7pkfM_t2-JGU5HKghhsX4sayQq8kqJVT97HE2-2JXKP6UsplrIUaa0elHPk3VeghyVSGKspc2IjpBPiyvNiS3keeQ1XmFip9z2mRBBM5tE4jiAevzqPfBePVbnkLDlew0HwjMJ0Fp_C7CKG2fvz86Pg2bI5qb8mF7NFPB9PZzGsibrEDbybT9-O55_gj-gTHFAYLyaHR8Gz6ex19BHWZElYuoaDpT8PDs-CYHweR_Od4aez36NJDIt4HE8X8XSygOefAwCAv_1v99OjVe6fdL0RhEf3x8091hvB57vD2r539_1l214jtZgSansj6J2Eg9N-OOiHAwgHozAchWFvy9g9Upjwb6NSOMAg3I7t5c6_Y-1GucR622Cv9rfAbZhT8TuHJ8PBydD_75-j_1vy8oeU7DP8cVUHX56f7eHmxnGz_A83qzZubnZws7zl5gO7imTO8s3FPJr-Oqstq0OYR2-ieTSbRAu45ecBvSe2w3liV93E3uwktq83-vjufDydwcHFu_gIotmHQ1hE5872J3gzv3gLG_jzt2geQQkvYXgW9Pv9fuCfIpsAbq6vb66_31x_hzsFsSN4MRjB5xdD6MOL4Zfg3wAAAP__BuWeVw==

statement ok
SET enable_zigzag_join = true

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE-ZJBlJK4mCWlWBoLoKIOd_5_c5H9vvwAbVhUoxgIpNLLWmyev0KcI3JsmQ8RQ0WjYWqtgqCfh8o5_IbURoV1UioIVJZojgVsKIG7AohxYyW3EJFeYkjkFnmcIk0lpiECkO-MbsijRVJJCeGXWEHPKUukw1vtZsuLo7g7etP3rjxzYTd6_t029hqKgxNLJOCKM2kZnbTBhRSF5S3ob-WlDO7ITIjBnXFktYENOYlp7rNkUaaEil4ax63zdmBLQ2STLphofaOTJcTpjHx8ygLQXUzKxR0yTHtxJqaF1nJObEOUuP34RZR7IDWfOXw0p2cAdwXc2tJSytdiDoRwgrFWcIsMchdupnUpFSOHa2hxC74dqucjyW1yYoYSy0WKGx74g-8CYPakowaSxS1q0eBipJbptwfMmUZS6jLwTiy-L51dazxcsXyK5qTvyQTrnliZ--a6eBauVZRkRKWC6mRCGlJxQxznuqBG8IESaTqohpLfd0P-mfQOHkglhUoS9vmIbzDPwkgLOqK8r3Lr6SxuUbjAJzqHGsiOgoSLb-1TnMQhj4Il0mzssqygl1hShTVlrnyMCVMpLj23vZPmMvk8lFFCZed1ClqTAmnptW66brbZ09yonElC3RFda6mT8mps1Gc1dpLOCtYa7CT8OfTBuOboBsR0ZhQ07USD0ErZqzMNS2ehPKr4S8ES58Wb5vQflrYJXcqJ1bnxbFhBePUiT2xK41mJXlrS8PjoYdqzFATLuVlqfwKGq8h2WVnUC0Vzd0cmVClrSnARN619Bq9ZROrHuJL-GW4c-v9DM1XTgzNsOFNV2J3wvco-rqrmImc3M_A3-4KtS310gvaE_HuAnGz0yVHorRc0iXjey7gFjeailQWxGD7WtRIVuCVFK168j6eeLMtkXtMX0qxlKVIa_WgnCPvvgU9LJHCWE2ZExshnRBXnhdbyvPIm7jCxEq97z0lgmAyj8ZxBPH41Xnku3isyiVnyfEaDoJnFKaz-BRmFzHM3p-fHwXPls1J_TW5mC3i-Xg6i2FN1CVu4N18-nY8_wR_RJ_ggMJ4MTk8Cp5NZ6-jj7AmS8LSNRws_XlweBYE4_M4mu8MP539Hk1iWMTjeLqIp5MFPP8cAAD87X-7nx6tcv-q640gPLo_bu6x3gg-3x3W9r277y_b9hqpxZRQ2xtB7yQcnPbDQT8cQDgYheEoDHtbxu6dwoR_HpXCAQbhdmwvd_4pazfKJdbbBnu1vwVuw5yK3zk8GQ5Ohv5__xz935KXP6Rkn-GPqzr48vxsDzc3jpvlf7hZtXFzs4Ob5S03H9hVJHOWby7m0fTXWW1ZHcI8ehPNo9kkWsAtPw_oPbEdzhO76ib2Ziexfb3Rx3fn4-kMDi7exUcQzT4cwiI6d7Y_wZv5xVvYwJ-_RfMISngJw7Og3-_3A_8U2QRwc319c_395vo73CmIHcGLwQg-vxhCH14MvwT_BgAA__9ci55b

statement ok
SET optimizer_use_histograms = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zYUvq6e4sA3TYY4leNhCBz0wnXVzVvqFLbatSgKgpaOZC4UyZKUamcY0IfIE_ZJBlKK42CWlWJoLoKIOd_h-fnOd9jvwzvUhkkxgolMrrWkyerlC8A1JsuS8RQ1WDQWqtoqCPp9oJzLL0RpVFQjoYZIZYniVMCKGrArhBQzWnILFeUljkBmmcMl0lhiEioM-cLsijRWJJGcGHaDHfCUukg2vNVuurg6gdcvP3jjxjcT9qDv811jq6kwNLFMCqI0k5rZTRtQSF1Q3ob-XFLO7IbIjBjUFUtaA9CYl5zqNkcaaUqk4K1x3BVnD7Y0SDLpmoXaOzJdTpjGxPejLATVTa9Q0CXHtBNral5kJefEOkiNP4RbRLEDWvOZw3N3cgFwn8ydJS2tdFfUgRBWKM4SZolB7sLNpCalcuxovUrsg--WyvlYUpusiLHUYoHCtgf-wJswqC3JqLFEUbt6FKgouWXK_SFTlrGEuhiMI4uvW1fFGi83LL-hOflLMuGKJ_bWrukOrpUrFRUpYbmQGomQllTMMOepbrghTJBEqi6qsdTn_aB-Bo2TB2JZgbK0bR7CLf67AMKirig_OPxKGptrNA7Aqc6xJqKjINHyS2s3B2HoL-EyaUZWWVawG0yJotoylx6mhIkU197b4Q5zmVw_KinhopM6RY0p4dS0WjdVd_PsSU40rmSBLqnO0fQhOXU2irNaewlnBWu97Cz8-bzB-CLoRkQ0JtQcHAlHzIeoFTNW5poW5sBsb0PcAfrx8EvB0q4xfIjcJbXvGHZJnsqJ1XlxaljBOHWCT-xKo1lJ3lrW8HTooRoz1IRLeV0qP4bG60h23XmplormrpdMqNLWNGAi7xp8jd6yuatu5HP4Zbi3sr6P5jMnhmbYcKcrsK34PYrCbh0zkZP7HvgNr1DbUi-9qH0n3i0R1ztdciRKyyVdMn5gCbe40VSksiAG20ejRrICb6Ro1ZS38cSb7QjdY-pSiqUsRVorCOUcefcm9LBECmM1ZU5whHRiXHle7KjPI7dxhYmV-tCbSgTBZB6N4wji8YvLyFfxVJVLzpLTNRwFTyhMZ_E5zK5imL29vDwJniybk_prcjVbxPPxdBbDmqhr3MCb-fT1eP4B_og-wBGF8WJyfBI8mc5eRu9hTZaEpWs4Wvrz4PgiCMaXcTTfe_109ns0iWERj-PpIp5OFvD0YwAA8Lf_7X56tMr9y643gvDk_rjZZb0RfNwe1va97fenXXuN1GJKqO2NoHcWDs774aAfDiAcjMJwFIa9HWP3VmHCP5FK4QCDcPdur3j-OWs3ygXW2wV7xb8D7sKckm8dng0HZ0P_v39O_m_Kyx-Sso_wx2UdfHp6cYCbG8fN8j_crNq4udnDzfKOmw_sKpI5y1dX82j666y2rI5hHr2K5tFsEi3gjp9H9J7YDueJXXUTe7OX2D7f6P2by_F0BkdXb-ITiGbvjmERXTrbn-DV_Oo1bODP36J5BCU8h-FF0O_3-4F_jmwC-HZ7--3267fbr7BVEDuCZ4MRfHw2hD48G34K_g0AAP__lzSevQ==

statement ok
SET optimizer_use_multicol_stats = false

query T
EXPLAIN (OPT, ENV) SELECT * FROM y WHERE u = 3
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbJh_iVI4_LAIHvXBddde7qVPYardFURC0NJK5oUiWpFQ7iwX6EHnCPsmClOI4qGWlWDQXQcTMGc7PmTPs9-EdasOkGMFEJtda0mT18gXgGpNlyXiKGiwaC1VtFQT9PlDO5ReiNCqqkVBDpLJEcSpgRQ3YFUKKGS25hYryEkcgs8zhEmksMQkVhnxhdkUaK5JITgy7wQ54Sl0kG95qN11cncDrlx-8ceObCXvQ9_musdVUGJpYJgVRmknN7KYNKKQuKG9Dfy4pZ3ZDZEYM6oolrQFozEtOdZsjjTQlUvDWOO6KswdbGiSZdM1C7R2ZLidMY-L7URaC6qZXKOiSY9qJNTUvspJzYh2kxh_CLaLYAa35zOG5O7kAuE_mzpKWVror6kAIKxRnCbPEIHfhZlKTUjl2tF4l9sF3S-V8LKlNVsRYarFAYdsDf-BNGNSWZNRYoqhdPQpUlNwy5f6QKctYQl0MxpHF162rYo2XG5bf0Jz8JZlwxRN7a9d0B9fKlYqKlLBcSI1ESEsqZpjzVDfcECZIIlUX1Vjq835QP4PGyQOxrEBZ2jYP4Rb_QwBhUVeUHxx-JY3NNRoH4FTnWBPRUZBo-aW1m4Mw9JdwmTQjqywr2A2mRFFtmUsPU8JEimvv7XCHuUyuH5WUcNFJnaLGlHBqWq2bqrt59iQnGleyQJdU52j6kJw6G8VZrb2Es4K1XnYW_v-8wfgi6EZENCbUHBwJR8yHqBUzVuaaFubAbO9F-vnwW8FS24H-LthdYvuuYZfsqZxYnRenhhWMUyf6xK40mpXkraUNT4ceqjFDTbiU16Xyo2i8lmTXnZdqqWju-smEKm1NBSbyruHX6C2bu-pmPodfhnvr43tpPnNiaIYNf7oC2wrgo2jsVjITObnvgd_yCrUt9dIL2w_i3SJxvdMlR6K0XNIl4wcWcYsbTUUqC2KwfTxqJCvwRopWXXkbT7zZjtg9pi6lWMpSpLWKUM6Rd29DD0ukMFZT5kRHSCfIlefFjgI9ciNXmFipD72rRBBM5tE4jiAev7iMfBVPVbnkLDldw1HwhMJ0Fp_D7CqG2dvLy5PgybI5qb8mV7NFPB9PZzGsibrGDbyZT1-P5x_gj-gDHFEYLybHJ8GT6exl9B7WZElYuoajpT8Pji-CYHwZR_O9109nv0eTGBbxOJ4u4ulkAU8_BgAAf_vf7qdHq9y_7nojCE_uj5t91hvBx-1hbd_bfn_atddILaaE2t4Iemfh4LwfDvrhAMLBKAxHYdjbMXbvFSb8M6kUDjAId-_2queftHajXGC9XbBX_TvgLsyp-dbh2XBwNvT_--fkv6a8_Ckp-wh_XtbBp6cXB7i5cdwsv-Nm1cbNzR5ulnfcfGBXkcxZvrqaR9NfZ7VldQzz6FU0j2aTaAF3_Dyi98R2OE_sqpvYm73E9vlG799cjqczOLp6E59ANHt3DIvo0tn-D17Nr17DBv78LZpHUMJzGF4E_X6_H_gnySaAb7e3326_frv9ClsFsSN4NhjBx2dD6MOz4afg3wAAAP__FE6fHw==

statement ok
RESET reorder_joins_limit

statement ok
RESET enable_zigzag_join

statement ok
RESET optimizer_use_histograms

statement ok
RESET optimizer_use_multicol_stats

#
# Test sequences.
#

statement ok
CREATE SEQUENCE seq

query T
EXPLAIN (OPT, ENV) SELECT * FROM seq
----
https://cockroachdb.github.io/text/decode.html#eJyUVt9PG0kMfs9fMY93p6YK0BauqA9cuichQehBQL0na7Lr3fiYHU88M-HHX3-a2W0LEpuFtxX4sz3-Pn_OdKpuUDyx_azmXN4K63L99S-F91iuIpkKRQX0QW27qMlkOlXaGL4DJ-i0IGgP7AI4o61aa6_CGlWFtY4mqK02ET8rruuEK9kH8KW2Hu4orKGPgpINeHrEEXilUycPZjDu9OrinTr_-m8O7nOTDTtzHz0NDqKt12UgtuCEWCg8DAEtS6vNEHoTtaHwAFyDR9lSOdiAYBONlqFEgroCtmawjx_DeQEbPULNiSyUnMiPJSHBMvMRW6ul5wqtXhmsRrG-00UdjYGQIB1-F-6qWCZg8BujvqS_HCv16zE_InUMnEp0jQC1zlBJATya1G7NAtEldQyWsi_Bn44q5VjpUK7BBx2wRRuGG3-WzXqUALX2AZwO61eB2mgCufTBFdVU6tSDT2LJcxuZdJ_kkZpH3cB_TGN7h_cuzUnbCqixLAiWA2zJU8rTse2BLJTsxnRGVX70s-F59MkbIFCLHMNQhtlP_JsANqBstdm5-Y59aAR9AhgtDXYqTPoD4btBKvdms1zEcNnvqwvU0iNW4LQESs_DCshWeJ-z7abXcHn7qkfZ1B1LhYIVGO0Ho_upp2XOCgfBNbeYHjW6l7mlZM3eGeqMFwy1NFhsf_bhqMfkIUjvIIKl9mP78By0Jh-4Ed2-CZX3Il-DoN9W76mgM1s45nWugSBN-95TS0Ynp4ewFvRrNoMjnb0_yFDBGgUM8210eQF9NpD6drSosNNN4pGsi6GTANlmzCMFc2RfqyPxi_p08KJdZg79xoDXNfa6GWvsp-u9Sr7pDpNt4BcH-bQ7lBBlld3sjfh0PRJ3Eg2CE17pFZkd13cgjWhbcQseh9eiQ1KLj2wH_eR6Oc9hT0zuNXOJdsXRVp17aGPQjJ_ADCvZ-iCaktlYTka8zbp44jyvPMNbLAPLrh9TdjKZXxYny0JdFf9cF4t5oVxcGSrfe9yo89PFzcnZdaH21PnJ9-7zz_39g4PD_dnBp6OPHw4PPx7NDtXpYn5ZnBeLpdpTV8uTy6XaO55Miu_fzk5OF-q3i2_Ld6pY3PyuroqzYr5Uf6i_Ly_OlcfN8WQ6nU4nHjcRbYnT7oqn_0z-DwAA___gV8fO

#
# Test views.
#

statement ok
CREATE VIEW v AS SELECT a, b, u, v FROM x, y WHERE b = 3

query T
EXPLAIN (OPT, ENV) SELECT * FROM v
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u27gSvo6eYuCbxgd2IscHB4GDAsd11V3vpk5hq38oCoKSRjY3FKmSlGpnsUCxz5DLfbo8yYKUnDjbyEqwaC4Cm55vfr_5yH4f3qHSTIoRTGR8qSSNVy9fAK4xjgrGE1RgUBsoKyvP6_eBci6_klxhThUSqonMDck5FbCiGswKIcGUFtxASXmBI5BpanGx1IbomApNvjKzIrUViSUnml1hCzyhNpMNb7SbLi568PrlR2dc-2bC7PV9umtsFBWaxoZJQXLFpGJm0wQUUmWUN6G_FJQzsyEyJRpVyeLGBBQuC05VkyOFNCFS8MY8ts15AFtoJKm0w0LlHOk2J0xh7OZRZIKqelYoaMQxacXqihdpwTkxFlLh9-EWQWiBRn_h8NyenAHcFbO1pIWRNkSVCGFZzlnMDNHIbbqpVKTILTsaQ4mH4Lutsj4iauIV0YYazFCY5sTveRMalSEp1Ybk1KweBcoKblhuP8iEpSymNgdtyeL61tLp2skVW17RJflNsra9w3Vu-0RFQthSSIVESENKppn1U01bEyZILPM2nrHEFX2veRq11QZiWIayME0e_Fv8kwDCoCop37v5udRmqVBbAKdqiRULLf-Ikl8bRznwfReEy7je19ywjF1hQnKqDLPlYUKYSHDtvO0fL5fx5aOKEjY7qRJUmBBOdaN13XW7zI7hROFKZmiLat1Ll5KVZp1zVgkv4SxjjcFO_P-e1hjXBFUriMKY6rZ9uA9aMW3kUtHsSSi3F-42MPRp8XYJ7aaFbVqXL4lRy-xIs4xxapWemJVCvZK8saX-0dBBFaaoCJfyssjdAmonIOlla1Alc7q0c2QiL0xFASaWbRqp0FnWsaohPof_DR-USzdD_YUTTVOsedOW2K3qPYq-9h5mYknuZuCu9hyVKVTk1OyJeHt72NmpgiPJlYxoxPie27fBjaIikRnR2LwWFZJleCVFo568DSfObEfkHtOXQkSyEEmlHpRz5O1XoIPFUmijKLNiI6QV4tLxYkd5HnkNlxgbqfY9poTnTebBOAwgHL84D1wXj_Ii4iw-WsOhd0BhOgtPYXYRwuzt-XnPO4jqk-rb5GK2COfj6SyENckvcQNv5tPX4_lH-DX4CIcUxotJt-cdTGcvgw-wJhFhyRoOI3fudc88b3weBvMHw09nvwSTEBbhOJwuwulkAc8-eQAAv7v_9q9Dy6V70nVG4Pfujut7rDOCT7eHlX3n9vvnXXuF1GBCqOmMoHPiD077_qDvD8AfjHx_5PudHWP7SGHCvY0KYQEDfze2kzv3jjWb3CbW2QU7td8Cd2FWxW8dngwHJ0P32x-9f1ty9ENKdhn-uKq9z8_O9nBzY7lZfMfNsombmwe4WWy5ec-uJKm1fHUxD6Y_zSrLsgvz4FUwD2aTYAFbfh7SO2JbnCN22U7szYPE3q333TR4vw1Tui20e9fzDgpbo9eF8QIWwbn1QXsQ9aDoQQmv5hev729Q7x9x3_8czAOI4DkMzzwv-PDmfDydweHFm7AHwexdd-v0P5Wv8szr9_t9jwmBqu_eloexklp3Pbi5_uvm-tvN9TdwL6HNdyfr_9fLbn_508705vq6NrhVODOC45PjwQg-HQ-hD8fDz96OWcq4QaXh0KgCu97fAQAA___CW9_J

#
# Test tables in user-defined schemas.
#

statement ok
CREATE SCHEMA s;
CREATE TABLE s.t (a int primary key)

query T
EXPLAIN (OPT, ENV) SELECT * FROM s.t;
----
https://cockroachdb.github.io/text/decode.html#eJyUVt9v20YMfq7-intrM8RBtg5D0KAPrusB3hwnsNViwTAQtETJt5zuLjzK-fHXD3dy22SILOfNMPh95JEfP2o0Ul-Jg3b2g5q44oYdFpvPnxTdU7FutSmJlVAQte2ismw0UmiMuwPP5JEJMIDzAt6gVRsMSjakSqqwNaK2aFr6oFxVRVzhgkAo0Aa407KBXRQUzkDQjzQALzFW8mB642ary2N18fk6Be-4tZW93GdPg4XRBixEOwuetWMtD31A67hB04e-bdFoeQBXQSDe6qK3AKa6Nch9RExYgrOmt45vzXkB2waCysVhESeiMESimYo0j7axyLtZkcW1oXIQGzpdVK0xIBHS4ffhVtM8AiXcGvUx_nOu1I_HfIvEVlxM0RUCuvFGF1ogkInlVo6h9VEdvansS_CnrYoca5RiA0FQqCEr_YU_Y7OBWKDCIOBRNgeBmtaI9vGHK3WlC4w1hCiW1LeBTu9IHnX9iDX86_TQ3tG9j31CW4KurWMC6wS2OujI0007gLZQOD-kM12mRz9rXqAQvQFEN-Ra6WM4_Y5_FcAK8RbN3s33LkjNFCLAINfUqTDqD9jd9Y7y59PTlMS4YrevXnSjH6kEjyw6Po9K0Lak-8S2f7zGFTcHPcrG6hyXxFSCwdAbvet6XOakcGDauIbiowb3MpUUrTl4ozvjBaMb3Zvsl9Nfz3aY1ATeOQhTgWFoH56DNjqIqxmbV6HSXqRrIPi6fE8FnaZFQ17naxCum5OgG20wOj3IhilsnOlt6enJ-wRlqojBOHfT-rSAIRlIdTOYlJ3HOs5RW99KJwFt6yGPZEqRu1zdED-q396_aJdphuHWQMCKdroZKuy76x0k33iHta3hxwzSaffE0vI6udkr8fF6xNlxawg8uzWutdlzfXtoGG3pGgjUvxYdUjf06Gyvn3zJJynsickd0pfWrl1ry8490BgywycwwQpngzDqaDbWRSPeJl08cZ4Dz_CWCnG872PKZtlkOR3nU5WPP82nqYsn4UTUu-wNqtkiP1OLy1wtvsznx9mbyeVilS_Hs0WuBPwNPair5exivLxWf06v1TtU49XkKDs6z7LxPJ8u_885W_wxneRqlY_z2SqfTVbq7d__vD3PsulfV_PxbKHeXV7lx2q6-HqkVtN5jP1J_b68vFDhRM6z0Wg0ypLvSvZfAAAA___2k85S

#
# Test default_transaction_quality_of_service settings.
#

statement ok
SET default_transaction_quality_of_service=background

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVk1u3EgP3fcpamkD7sD-8mEQJPAik3gRIJMEsGPMrAi2REkcl4plFtX-WeUQPqFPMqiSktiA1bJ3jQYfyeJ7fNR67c5JE0t46z5IdaGCVffxT0fXVG0G9jWpM0rmtmPUarVeO_ReriAqRVQCTCDRIHoMrsPkrCNXU4ODN7dFP9BbJ02TcZUkg1RhSHDF1sEUBZV4SHxLC_Aacyc3fjbu0-nXA_fXx39K8JSbg-3M_eZhsCmGhJWxBIjKomw3c8Ag2qNfnZ6cPQm_HNCz3YA0kEi3XJE7dhusLlqVIdTvnPtd92dKpXbwqHMdKWENEvxsSz_n9AR2SASNZN5IS6K0lISVqkLN0AfUiTYKuPFUL2LTKJFm8B4sQ0b8LlwZJCdLl94d53-eHBEOJrnE2AhwHz1XbJDI53YbURhiFspsqfAU_OGoco4NWtVBMjTqKdh844-yhURq0GAyiGjds0D94I1j_iE1N1xh7iFl2ZS5LUx6SnLL7S228K_w0grSdcxzwlADt0GUIIjBlhPnPCPbCThAJXFJZ1yXRz8aXqKUbQKMe5LB5jIc_sK_CBCMdIt-pwlESdYqpQzwqC2NKsz6A5WrWSqPDg9LES_VtLnRuOdbqiGiGufnUQ0carou2XbT66W6eNajQu5OtCalGjym2ehp6nmZi8JBqZOe8qMW97K0lF06Rc-jB4PnnmeL_e_w_28mTBmCTg6iVGFa2ofHoI6TSavYvwhV9qIcBsOX1Xso6MIWLXldbMG07V8l7tljNn2wTil14mdHevjqdYEqNaTgRS6GWBYwFQNpLhaLqkRsM48c4mCjBDi0Sx6pVCKnWiOJx-6P10_aZeEwXXpI2NCkm6XGfrnes-SbTzKHFn5zUK58JLVBN8XNXojP1yNzp4MniCob3LDfcYhn0iiGWnpINL8WI5J7upUw6yffzz6UsAcm95y5DGGT7_zoHug9-eUTWGCVhGSKnM0mSDbibdHFA-d55hneUmWiu76rwmp18ve3z-8_fXF7X7-dHbiTL-f77vz95-8np27vaP_dar1er1clPK3c_d3d_d2P-7sfbu_oYH_1XwAAAP__htyzyw==

statement ok
SET default_transaction_quality_of_service=critical

query T
EXPLAIN (OPT, ENV) VALUES(1);
----
https://cockroachdb.github.io/text/decode.html#eJyUVs9OHMkPvs9T1BEkJoJfflpFiThkEw6RskkkCNo9WZ5qd4-X6nLhcg9_TnkInpAnWVX1JAGJnobbaOTPdvn7_LmXS3dOmlniW_dB_IUK-vXHPx1dk18NHBpSZ5TNbcaoxWK5dBiCXEFSSqgEmEGSQQoY3RqzszW5hlocgrkNhoHeOmnbgvOSDbLHmOGKbQ3bKPASIPMtzcAbLJ3chMm4T6dfD9xfH_-pwdvcHG1n7jcPg00xZvTGEiEpi7LdTAGjaI9hcXpy9iT8csDAdgPSQibdsCd37LyyscfwzrnfVX8mVOqGgDrVjxI2IDFMNvRzSk9gh0zQSmGNtCbKc0lYyVdihj6ibkmjiKtAzSw2jwJphxDACmTE78LVMXK2fBnccfnnyRHhYFJKjI0A9ymwZ4NMobTbisKQikwmS8Wn4A9HVXKs0PwasqFRT9GmG3-ULWZSgxazQUJbPwvUD8E4lR_ScMseSw-5iKbObWbS2yS33N1iB_8Kzy0gXacyJ4wNcBdFCaIYbDhzyTOynYEjeElzOuOmPvrR8DLlYhJg3JMMNpXh8Bf-RYBopBsMOy0gSbZOKRdAQO1oVGHRH6hcTVJ5dHhYiwTx271Nxj3fUgMJ1bg8jxrg2NB1zbab3iD-4lmPiqU70YaUGgiYJ6O3Uy_LXBUOSmvpqTxqdi9rS8Wjcwo8OjAE7nmy2P8O__9mi6lD0K2DKHnMc_vwGLTmbNIp9i9C1b2oZ8HwZfUeCrqyRXNelzow7fpXmXsOWCwfbK2U1xImR3r46nWFKrWkEEQuhlQXMFcDaS9mi6ok7AqPHNNgowQ4dnMeqVQjt7VGEo_dH6-ftMvKYb4MkLGlrW7mGvvles-SbznIHDv4zUG98YnUBl1VN3shvlyPwp0OgSCprHDFYccZnkijGBvpIdP0WoxI7ulW4qSffD_7UMMemNxz5jLElQyxGd0DQ6AwfwIrzEvMpsjFbKIUI95UXTxwnmee4Q15E931VRUXi5O_v31-_-mL2_v67ezAnXw533fn7z9_Pzl1e0f77xbL5XK5qOF54e7v7u7vftzf_XB7Rwf7i_8CAAD__yr4svY=

#
# Test recursive table references from foreign keys.
#

statement ok
CREATE TABLE z (
  pk INT PRIMARY KEY,
  ref INT,
  CONSTRAINT fk FOREIGN KEY (ref) REFERENCES y(u),
  FAMILY "primary" (pk, ref)
)

query T
EXPLAIN (OPT, ENV) SELECT * FROM z;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl9P47gXfSafwurLlJ9alMJPK1TEQ6eEVXdLi9rMaNBoZDnJTeqtYxvbCW1X-91XdgIUTdOAVsMDIuae-_f4XPf76CsoTQUforGI10qQeHXzGcEG4qigLAGFDGiDysrK8_p9RBgTT1gqkEQBJhoLabBkhKMV0cisACWQkoIZVBJWwBCJNLW4WGiDdUy4xk_UrHBthWPBsKY7aIEnxGayZY12k-W8h-5uHpxx7Ztyc9T35b6xUYRrEhsqOJaKCkXNtgnIhcoJ85ZBeBD-WBBGzRaLFGtQJY0BXaNYUUNjwq4Qeo367FBBVjCimvJRQBIsOGtM6LlLB7CFBpwKOzVQzpFuc0IVxG4wRc6JqocGnEQMklasrgiSFoxhYyEV_hjOtZFqox8ZurYnB1tECiNsiCoRTHPJaEwN1sBsuqlQuJCWJo2h-CH4fqusj4iYeIW1IQZy4KY58TfeuAZlcEq0wZKY1btAecEMlfYPkdCUxsTmoC1pXN9aOl072dFsRzL8l6BtFxA20vaJ8ATTjAsFmAuDS6qp9VNNW2PKcSxkG89o4op-0zwN2ooENjQHUZgmD_4L_kMAbkCVhB2VACm0yRRoC2BEZVCx0PIPK_HUOMqB77sgTMT1vZWG5nQHCZZEGWrLgwRTnsDGeTs-Xibi9buK4jY7oRJQkGBGdKN13XV7mR3DsYKVyMEW1XovXUpWo7VktFJgzGhOG4Od-_-_rDGuCapWEAUx0W334S1oRbURmSL5h1DuXri1YMjH4u0T2k0L2rROZtioLD_TNKeMWMnHZqVArwRrbKl_duGgClJQmAmxLqS7gNoJSLpuDaqEJJmdI-WyMBUFKM_aNFKBs6xjVUO8Rr9dHJRLN0P9yLAmKdS8aUvsRfXeRV-7kCnP8OsM3I6XoEyhIqdmH8Tb7WFnpwoGWCoRkYiyI2u4wY0iPBE51tB8LSokzWEneKOefAnHzmxP5N7Tl4JHouBJpR6EMWDtK9DBYsG1UYRaseHCCnHpeLGnPO9cwyXERqhjryrueeNFMAoDFI4-TwPXxTNZRIzGZxvU9U4ImszCSzSbh2j2ZTrteSdRfVJ9jeezZbgYTWYh2mC5hi26X0zuRosH9GfwgLoEjZbj0553MpndBN_QBkeYJhvUjdy5d3rleaNpGCwOhp_M_gjGIVqGo3CyDCfjJfr03UMIob_db_vTIWXm3nadIfJ7r8f1HusM0feXw8q-8_L9Y99eATGQYGI6Q9Q59weXfX_Q9wfIHwx9f-j7nT1j-0ih3L2NCm4BA38_tpM796A1W2kT6-yDndo_A_dhVsVfHJ5fDM4v3P_-6f3XkqNfUrLL8NdV7f34dHWEm1vLzeInbpZN3Nwe4GbxzM03diVOreXtfBFMfp9VluUpWgS3wSKYjYMleuZnl7wS2-Icsct2Ym8PEvt4vTtbr1z_VLCCtKnk3YGS5fpAzen6bbUK0kP1brvF8bp2zXUF3-6no8kMdef3YQ8Fs6-naBlMre3_0O1ifod2V16_3-977lm18_4NAAD__45tzLc=

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl9P47gXfSafwurLlJ9alMJPK1TEQ6eEVXdLi9rMaNBoZDnJTeqtYxvbCW1X-91XdgIUTdOAVsMDIuae-_f4XPf76CsoTQUforGI10qQeHXzGcEG4qigLAGFDGiDysrK8_p9RBgTT1gqkEQBJhoLabBkhKMV0cisACWQkoIZVBJWwBCJNLW4WGiDdUy4xk_UrHBthWPBsKY7aIEnxGayZY12k-W8h-5uHpxx7Ztyc9T35b6xUYRrEhsqOJaKCkXNtgnIhcoJ85ZBeBD-WBBGzRaLFGtQJY0BXaNYUUNjwq4Qeo367FBBVjCimvJRQBIsOGtM6LlLB7CFBpwKOzVQzpFuc0IVxG4wRc6JqocGnEQMklasrgiSFoxhYyEV_hjOtZFqox8ZurYnB1tECiNsiCoRTHPJaEwN1sBsuqlQuJCWJo2h-CH4fqusj4iYeIW1IQZy4KY58TfeuAZlcEq0wZKY1btAecEMlfYPkdCUxsTmoC1pXN9aOl072dFsRzL8l6BtFxA20vaJ8ATTjAsFmAuDS6qp9VNNW2PKcSxkG89o4op-0zwN2ooENjQHUZgmD_4L_kMAbkCVhB2VACm0yRRoC2BEZVCx0PIPK_HUOMqB77sgTMT1vZWG5nQHCZZEGWrLgwRTnsDGeTs-Xibi9buK4jY7oRJQkGBGdKN13XV7mR3DsYKVyMEW1XovXUpWo7VktFJgzGhOG4Od-_-_rDGuCapWEAUx0W334S1oRbURmSL5h1DuXri1YMjH4u0T2k0L2rROZtioLD_TNKeMWMnHZqVArwRrbKl_duGgClJQmAmxLqS7gNoJSLpuDaqEJJmdI-WyMBUFKM_aNFKBs6xjVUO8Rr9dHJRLN0P9yLAmKdS8aUvsRfXeRV-7kCnP8OsM3I6XoEyhIqdmH8Tb7WFnpwoGWCoRkYiyI2u4wY0iPBE51tB8LSokzWEneKOefAnHzmxP5N7Tl4JHouBJpR6EMWDtK9DBYsG1UYRaseHCCnHpeLGnPO9cwyXERqhjryrueeNFMAoDFI4-TwPXxTNZRIzGZxvU9U4ImszCSzSbh2j2ZTrteSdRfVJ9jeezZbgYTWYh2mC5hi26X0zuRosH9GfwgLoEjZbj0553MpndBN_QBkeYJhvUjdy5d3rleaNpGCwOhp_M_gjGIVqGo3CyDCfjJfr03UMIob_db_vTIWXm3nadIfJ7r8f1HusM0feXw8q-8_L9Y99eATGQYGI6Q9Q59weXfX_Q9wfIHwx9f-j7nT1j-0ih3L2NCm4BA38_tpM796A1W2kT6-yDndo_A_dhVsVfHJ5fDM4v3P_-6f3XkqNfUrLL8NdV7f34dHWEm1vLzeInbpZN3Nwe4GbxzM03diVOreXtfBFMfp9VluUpWgS3wSKYjYMleuZnl7wS2-Icsct2Ym8PEvt4vTtbr1z_VLCCtKnk3YGS5fpAzen6bbUK0kP1brvF8bp2zXUF3-6no8kMdef3YQ8Fs6-naBlMre3_0O1ifoe2V16_3-977lm19f4NAAD__45czLU=

query T
EXPLAIN (OPT, ENV) SELECT * FROM x;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vl9P47gXfSafwurLlJ9alMJPK1TEQ6eEVXdLi9rMaNBoZDnJTeqtYxvbCW1X-91XdgIUTdOAVsMDIuae-_f4XPf76CsoTQUforGI10qQeHXzGcEG4qigLAGFDGiDysrK8_p9RBgTT1gqkEQBJhoLabBkhKMV0cisACWQkoIZVBJWwBCJNLW4WGiDdUy4xk_UrHBthWPBsKY7aIEnxGayZY12k-W8h-5uHpxx7Ztyc9T35b6xUYRrEhsqOJaKCkXNtgnIhcoJ85ZBeBD-WBBGzRaLFGtQJY0BXaNYUUNjwq4Qeo367FBBVjCimvJRQBIsOGtM6LlLB7CFBpwKOzVQzpFuc0IVxG4wRc6JqocGnEQMklasrgiSFoxhYyEV_hjOtZFqox8ZurYnB1tECiNsiCoRTHPJaEwN1sBsuqlQuJCWJo2h-CH4fqusj4iYeIW1IQZy4KY58TfeuAZlcEq0wZKY1btAecEMlfYPkdCUxsTmoC1pXN9aOl072dFsRzL8l6BtFxA20vaJ8ATTjAsFmAuDS6qp9VNNW2PKcSxkG89o4op-0zwN2ooENjQHUZgmD_4L_kMAbkCVhB2VACm0yRRoC2BEZVCx0PIPK_HUOMqB77sgTMT1vZWG5nQHCZZEGWrLgwRTnsDGeTs-Xibi9buK4jY7oRJQkGBGdKN13XV7mR3DsYKVyMEW1XovXUpWo7VktFJgzGhOG4Od-_-_rDGuCapWEAUx0W334S1oRbURmSL5h1DuXri1YMjH4u0T2k0L2rROZtioLD_TNKeMWMnHZqVArwRrbKl_duGgClJQmAmxLqS7gNoJSLpuDaqEJJmdI-WyMBUFKM_aNFKBs6xjVUO8Rr9dHJRLN0P9yLAmKdS8aUvsRfXeRV-7kCnP8OsM3I6XoEyhIqdmH8Tb7WFnpwoGWCoRkYiyI2u4wY0iPBE51tB8LSokzWEneKOefAnHzmxP5N7Tl4JHouBJpR6EMWDtK9DBYsG1UYRaseHCCnHpeLGnPO9cwyXERqhjryrueeNFMAoDFI4-TwPXxTNZRIzGZxvU9U4ImszCSzSbh2j2ZTrteSdRfVJ9jeezZbgYTWYh2mC5hi26X0zuRosH9GfwgLoEjZbj0553MpndBN_QBkeYJhvUjdy5d3rleaNpGCwOhp_M_gjGIVqGo3CyDCfjJfr03UMIob_db_vTIWXm3nadIfJ7r8f1HusM0feXw8q-8_L9Y99eATGQYGI6Q9Q59weXfX_Q9wfIHwx9f-j7nT1j-0ih3L2NCm4BA38_tpM796A1W2kT6-yDndo_A_dhVsVfHJ5fDM4v3P_-6f3XkqNfUrLL8NdV7f34dHWEm1vLzeInbpZN3Nwe4GbxzM03diVOreXtfBFMfp9VluUpWgS3wSKYjYMleuZnl7wS2-Icsct2Ym8PEvt4vTtbr1z_VLCCtKnk3YGS5fpAzen6bbUK0kP1brvF8bp2zXUF3-6no8kMdef3YQ8Fs6-naBlMre3_0O1ifoc2V16_3-977lm18f4NAAD__45LzLM=

# A foreign key cycle shouldn't cause infinite recursion.
statement ok
ALTER TABLE y ADD CONSTRAINT fk FOREIGN KEY (v) REFERENCES z (pk);

query T
EXPLAIN (OPT, ENV) SELECT * FROM y;
----
https://cockroachdb.github.io/text/decode.html#eJy0Vt1u2zgTva6eYuCbOh_iQE4-LAIHvXBddeHd1C5stWhRFAQtjWSuKZIlKcf2Yt99QUpJHFSyEiyaiyBi5szvmUMOBvAZtWFSjGAik42WNFm_ewu4w2RVMp6iBovGwrayCoLBACjn8o4ojYpqJNQQqSxRnApYUwN2jZBiRktuYUt5iSOQWeZwiTSWmIQKQ-6YXZPaiiSSE8MO2AFPqctkz1vtpsv5OXx499Ub176ZsCd9Xx8bW02FoYllUhClmdTM7tuAQuqC8mAZxY3wHyXlzO6JzIhBvWUJwhtINLMsofwG4DHqvUONecmpbstHI02JFLw1ofsuNWBLgySTbmqovSPT5YRpTPxgykJQXQ8NBV1xTDuxpiJIVnJOrINU-FM430ZmrPnB4Y07aWwRLa10IapECCsUZwmzxCB36WZSk1I5mrSGEk3w41Y5HytqkzUxllosUNj2xJ94Ewa1JRk1lihq188CFSW3TLk_ZMoyllCXg3Gk8X3r6HTt5MDyA83JX5J1LSDulOsTFSlhuZAaiZCWbJlhzk81bUOYIIlUXTxjqS_6SfMMGicSxLICZWnbPIQP-BcBhEW9pfykBChpbK7ROACnOseKhY5_RMu71lEOw9AH4TKp91ZZVrADpkRRbZkrD1PCRIo77-30eLlMNs8qSrjspE5RY0o4Na3WddfdMnuGE41rWaArqnMvfUpOo43irFJgwlnBWoNdhv-_rjG-CbpWEI0JNV378BS0ZsbKXNPiRSi_F_5asPRl8Y4J7aeFXVqncmJ1XlwYVjBOneQTu9Zo1pK3tjS8uPJQjRlqwqXclMovoPECkm06g2qpaO7myIQqbUUBJvIujdToLetY1RDfwG9XjXLpZ2h-cGJohjVvuhJ7UL1n0dddyEzk5HEG_o5XqG2pV17NXoh3t4ebnS45EqXliq4YP3ENt7jRVKSyIAbb16JCsgIPUrTqyad44s2ORO45fSnFSpYirdSDco68-wr0sEQKYzVlTmyEdEK89bw4Up5nXsNbTKzUp15VIggmi2gcRxCP395GvosXqlxxllzsoB-8ojCdxdcwm8cw-3R7ex68WtUn1ddkPlvGi_F0FsOOqA3u4eNi-mG8-Ap_Rl-hT2G8nJydB6-ms3fRF9iRFWHpDvorfx6c3QTB-DaOFo3hp7M_okkMy3gcT5fxdLKE198CAIC__W_306Pb3L_teiMIzx-P63usN4JvD4eVfe_h-_uxvUZqMSXU9kbQuwyH14NwOAiHEA5HYTgKw96RsXukMOHfRqVwgGF4HNvLnX_Q2r1yifWOwV7t74HHMKfiDw4vr4aXV_5__5z_15JXv6Rkn-Gvqzr4_vrmBDcPjptq8xM5NWZt9Dw00FNt7vl5ZJht4P18EU1_n1VGGrMzWETvo0U0m0RLqFPY98vTBD40Evh0XXtXV_lTWdu2ovYNRZUNNe3JlmTO8kll26a6dn3a0ZBG2KGvNo-L7uL5Rd92L_q-vU_Rl4-34-kM-vOP8TlEs89nsIxune3_4P1i_gH2N8FgMBgE_jm2D_4NAAD__2qK3Hk=

# Check that we remove histograms from statistics correctly.

statement ok
CREATE TABLE b (
  b BOOL NOT NULL,
  INDEX (b)
)

statement ok
ALTER TABLE b INJECT STATISTICS '[
      {
          "avg_size": 1,
          "columns": [
              "b"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 2,
          "histo_buckets": [
              {
                  "distinct_range": 0,
                  "num_eq": 1000,
                  "num_range": 0,
                  "upper_bound": "false"
              },
              {
                  "distinct_range": 0,
                  "num_eq": 100,
                  "num_range": 0,
                  "upper_bound": "true"
              }
          ],
          "histo_col_type": "BOOL",
          "histo_version": 2,
          "name": "__auto__",
          "null_count": 0,
          "row_count": 1100
      },
      {
          "avg_size": 0,
          "columns": [
              "rowid"
          ],
          "created_at": "2022-12-02 18:34:29.574932",
          "distinct_count": 0,
          "histo_col_type": "",
          "name": "__auto__",
          "null_count": 0,
          "row_count": 0
      }
]'

query T
EXPLAIN (OPT, ENV) SELECT * FROM b
----
https://cockroachdb.github.io/text/decode.html#eJy8Vt9v2zYQfq7-CsIvTYc4cJxuSx30wXVcwJtrF7FatCiKAyWd5FsokiEp58ew_30gpSQOEFnOw5aHICHvuzt9d_cd-332FY0lJUdsotJLo3i6Pv_A8AbTpCKRoWEOrWOb2iqK-n3GhVDXoA1qbhC4BaUdaMElW3PL3BpZhjmvhGMbLiocMZXnHpcq68CmXFq4JreGxgpSJcDSHXbAM-4zuRWtdrPV8pB9Ov8ejBvfJN1O36fbxs5waXnqSEnQhpQhd9sGlMqUXESrafws_KrigtwtqBwsmg2lyN6z1JCjlIszxh6j3js0WFSCm7Z8DPIMlBStCd2z9Ay2sgi58lVDExzZLidkMA2FqUrJTVM0lDwRmHVibd0geSUEOA-p8btwgUayzl4J9t6fPEsRr5zyIepEgEotKCUHFoVPN1cGKu3bpDWUfA6-TZX3kXCXrsE67rBE6doTf-JNWjQOcm4daO7We4HKSjjS_g-VUU4p9zlY3zSBtw6mGyd3VNzxAv5S1DWAeKM9T1xmQIVUBkEqBxuy5P3U1bZAElKlu_qMsvDRT8izaL1IgKMSVeXaPAwe8C8CSIdmw8VOCdDKusKg9QDBTYF1F_r-A6OuW0t5PBiEIEKlzdxqRyXdYQaaG0f-8zADkhneBG-7yytUernXR0mfnTIZGsxAcNtq3bDuhzl0OBhcqxL9R3XOZUjJa7TVgmoFBkEltQYbDt6eNphAgmkUxGDKbdc8PAWtyTpVGF6-CBXmIqwFx18Wb7uhQ7WwS-t0Ac4U5ZGlkgT3kg9ubdCulWildHB0EqAGczQglLqsdBhAGwQkv-wMapTmha8jSV25ugVIFl0aaTBYNrHqIr5nv508K5ehhvZKgOU5Nn3TldiD6u3Vvn4hkyzgsQZhx2s0rjJJULMX4v328LUzlUDQRiU8IbFjDbe4MVxmqgSL7WNRI6nEOyVb9eRLPAlmWyK3Dy-VTFQls1o9uBAouldggKVKWmc4ebGRygvxJvTFlvLsuYY3mDpldr2qZBRNLqbjeMri8Yf5NLB4pKtEUHqUsIPoVcI-LJdztljGbPFlPj-MXhl1TRmbLeLTcPp1tpp55L0FO59-HH-Zx6ySdFUFcaLs4M1h9GqyXKzii_FsEbME9CXess8Xs0_ji-_sz-l3dlD7Ha8m3na2OJ9-YwkkQNkNO0jCefTmLIrG83h68Wy2s8Uf00nMVvE4nq3i2WTFXv-IGGPs7_Db__T4pghPwd6IHR8-HjdrrzdiPx4Ow0XSe_j_57a9Qe4wA-56I9YbDobD_vGwPxiy49PRydvR8N3Rr7-_fXcy7G1h_NOGZHhRVdLjhluXQSLDI9jdap9dbxsqeRnOAPzrB-DJnd8e9y4HWxd-K9yfHx8PBuHmn8MdjAz2YSSU6T9kZfD_sdJQEv18fRZF02-f5-PZgh0sP8eHbLr4-oatpnPfUL-wjxfLTyw5i_r9fj8Kmz-J_g0AAP__YgJsTQ==
